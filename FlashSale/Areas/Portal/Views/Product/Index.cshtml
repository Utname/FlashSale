@model FlashSale.Areas.Portal.Model.ProductFilterModel

@{
    ViewBag.Title = "Index";
    Layout = "~/Areas/Portal/Views/Shared/_Layout.cshtml";
}


<div class="breadcrumb-area">
    <div class="container">
        <div class="breadcrumb-content">
            <ul>
                <li><a href="index.html">Trang chủ</a></li>
                <li class="active">Sản phẩm</li>
            </ul>
        </div>
    </div>
</div>
<!-- Li's Breadcrumb Area End Here -->
<!-- Begin Li's Content Wraper Area -->
<div class="content-wraper pt-60 pb-60 pt-sm-30">
    <div class="container">
        <div class="row">
            <div class="col-lg-9 order-1 order-lg-2">
                <!-- Begin Li's Banner Area -->
                <div class="single-banner shop-page-banner">
                    <a href="#">
                        <img src="@Model.Ads" alt="Li's Static Banner">
                    </a>
                </div>
                <!-- Li's Banner Area End Here -->
                <!-- shop-top-bar start -->
                <div class="shop-top-bar mt-30">
                    <div class="shop-bar-inner">
                        <div class="product-view-mode">
                            <!-- shop-item-filter-list start -->
                            <ul class="nav shop-item-filter-list" role="tablist">
                                <li class="active" role="presentation"><a aria-selected="true" class="active show" data-toggle="tab" role="tab" aria-controls="grid-view" href="#grid-view"><i class="fa fa-th"></i></a></li>
                                <li role="presentation"><a data-toggle="tab" role="tab" aria-controls="list-view" href="#list-view"><i class="fa fa-th-list"></i></a></li>
                            </ul>
                            <!-- shop-item-filter-list end -->
                        </div>
                        <div class="toolbar-amount">
                            <span>Showing @((Model.PageNumber - 1) * Model.PageSize + 1)-@((Model.PageNumber - 1) * Model.PageSize + Model.Products.Count()) of @Model.TotalItems item(s)</span>
                        </div>
                    </div>
                    <!-- product-select-box start -->
                    <form id="sortForm" method="get" action="@Url.Action("Index", "Product")">
                        <div class="product-select-box">
                            <div class="product-short">
                                <p>Sắp xếp:</p>
                                <select class="nice-select" id="sortBySelect" name="ShortBy" onchange="submitSortForm()">
                                    @foreach (var sortBy in Data.Helpers.Common.Constants.shortByList)
                                    {
                                        <option value="@sortBy.id" @(sortBy.id == Model.ShortBy ? "selected" : "")>@sortBy.name</option>
                                    }
                                </select>
                            </div>
                        </div>
                        <input type="hidden" name="idGroup" value="@Model.idGroup" />
                        <input type="hidden" name="idType" value="@Model.idType" />
                        <input type="hidden" name="ShortBy" value="@Model.ShortBy" /> <!-- Keep this here -->
                    </form>
                    <!-- product-select-box end -->
                </div>
                <!-- shop-top-bar end -->
                <!-- shop-products-wrapper start -->
                <div class="shop-products-wrapper">
                    <div class="tab-content">
                        <div id="grid-view" class="tab-pane fade active show" role="tabpanel">
                            <div class="product-area shop-product-area">
                                <div class="row">
                                    @foreach (var product in Model.Products)
                                    {
                                        <div class="col-lg-4 col-md-4 col-sm-6 mt-40">
                                            <!-- single-product-wrap start -->
                                            <div class="single-product-wrap">
                                                <div class="product-image">
                                                    <a href="single-product.html">
                                                        <img src="@product.Image" alt="Li's Product Image">
                                                    </a>
                                                    <span class="sticker">New</span>
                                                </div>
                                                <div class="product_desc">
                                                    <a href="~/Portal/Product/Details?id=@product.Id">
                                                        <div class="product_desc_info">
                                                            <div class="product-review">
                                                                <h5 class="manufacturer">
                                                                    <a href="shop-left-sidebar.html">Shop:@product.ShopName</a>
                                                                </h5>
                                                                <div class="rating-box">
                                                                    <ul class="rating">
                                                                        <li><span>@product.AverageRating</span>&nbsp;<i class="fa fa-star-o" style="font-size:17px"></i></li>
                                                                    </ul>
                                                                </div>
                                                            </div>
                                                            <h4><a class="product_name" href="single-product.html">@product.Name</a></h4>
                                                            <div class="price-box">
                                                                @if (product.DiscountPercentage > 0)
                                                                {
                                                                    <p class="mb-0">
                                                                        <span class="new-price new-price-2">@Html.Raw(String.Format("{0:N0}", product.StartingPrice - product.DiscountFrom))đ</span>
                                                                        @if (product.DiscountUpTo != null && product.DiscountUpTo > 0)
                                                                        {
                                                                            <span class="new-price new-price-2">- @Html.Raw(String.Format("{0:N0}", product.EndingPrice - product.DiscountUpTo))đ</span>
                                                                        }
                                                                    </p>

                                                                    <p class="mb-0">
                                                                        <span class="old-price">@Html.Raw(String.Format("{0:N0}", product.StartingPrice))đ</span>
                                                                        @if (product.EndingPrice != null && product.EndingPrice > 0)
                                                                        {
                                                                            <span class="old-price"> - @Html.Raw(String.Format("{0:N0}", product.EndingPrice))đ</span>

                                                                        }
                                                                        <span class="discount-percentage">-@product.DiscountPercentage%</span>
                                                                    </p>
                                                                }
                                                                else
                                                                {
                                                                    <span class="new-price new-price-2">@Html.Raw(String.Format("{0:N0}", product.StartingPrice))đ</span>
                                                                    if (product.EndingPrice > 0)
                                                                    {
                                                                        <span class="new-price new-price-2">- @Html.Raw(String.Format("{0:N0}", product.EndingPrice))đ</span>
                                                                    }
                                                                }
                                                            </div>
                                                        </div>
                                                        <div class="add-actions">
                                                            <ul class="add-actions-link">
                                                                <li class="add-cart active"><a href="shopping-cart.html">Add to cart</a></li>
                                                                <li><a href="#" title="quick view" class="quick-view-btn" data-toggle="modal" data-target="#exampleModalCenter"><i class="fa fa-eye"></i></a></li>
                                                                <li><a class="links-details" href="wishlist.html"><i class="fa fa-heart-o"></i></a></li>
                                                            </ul>
                                                        </div>
                                                    </a>
                                                </div>
                                            </div>
                                            <!-- single-product-wrap end -->
                                        </div>
                                    }
                                </div>
                            </div>
                        </div>
                        <div id="list-view" class="tab-pane fade product-list-view" role="tabpanel">
                            <div class="row">
                                <div class="col">
                                    @foreach (var product in Model.Products)
                                    {
                                        <div class="row product-layout-list">
                                            <div class="col-lg-3 col-md-5 ">
                                                <div class="product-image">
                                                    <a href="single-product.html">
                                                        <img src="@product.Image" alt="Li's Product Image">
                                                    </a>
                                                    <span class="sticker">New</span>
                                                </div>
                                            </div>
                                            <div class="col-lg-5 col-md-7">
                                                <div class="product_desc">
                                                    <a href="~/Portal/Product/Details?id=@product.Id">
                                                        <div class="product_desc_info">
                                                            <div class="product-review">
                                                                <h5 class="manufacturer">
                                                                    <a href="shop-left-sidebar.html">Shop:@product.ShopName</a>
                                                                </h5>
                                                                <div class="rating-box">
                                                                    <ul class="rating">
                                                                        <li><span>@product.AverageRating</span>&nbsp;<i class="fa fa-star-o" style="font-size:17px"></i></li>
                                                                    </ul>
                                                                </div>
                                                            </div>
                                                            <h4><a class="product_name" href="single-product.html">Hummingbird printed t-shirt</a></h4>
                                                            <div class="price-box">
                                                                @if (product.DiscountPercentage > 0)
                                                                {
                                                                    <p class="mb-0">
                                                                        <span class="new-price new-price-2">@Html.Raw(String.Format("{0:N0}", product.StartingPrice - product.DiscountFrom))đ</span>
                                                                        @if (product.DiscountUpTo != null && product.DiscountUpTo > 0)
                                                                        {
                                                                            <span class="new-price new-price-2">- @Html.Raw(String.Format("{0:N0}", product.EndingPrice - product.DiscountUpTo))đ</span>
                                                                        }
                                                                    </p>

                                                                    <p class="mb-0">
                                                                        <span class="old-price">@Html.Raw(String.Format("{0:N0}", product.StartingPrice))đ</span>
                                                                        @if (product.EndingPrice != null && product.EndingPrice > 0)
                                                                        {
                                                                            <span class="old-price"> - @Html.Raw(String.Format("{0:N0}", product.EndingPrice))đ</span>

                                                                        }
                                                                        <span class="discount-percentage">-@product.DiscountPercentage%</span>
                                                                    </p>
                                                                }
                                                                else
                                                                {
                                                                    <span class="new-price new-price-2">@Html.Raw(String.Format("{0:N0}", product.StartingPrice))đ</span>
                                                                    if (product.EndingPrice > 0)
                                                                    {
                                                                        <span class="new-price new-price-2">- @Html.Raw(String.Format("{0:N0}", product.EndingPrice))đ</span>
                                                                    }
                                                                }


                                                            </div>
                                                            @*   <p></p>*@
                                                        </div>
                                                    </a>
                                                </div>
                                            </div>
                                            <div class="col-lg-4">
                                                <div class="shop-add-action mb-xs-30">
                                                    <ul class="add-actions-link">
                                                        <li class="add-cart"><a href="#">Add to cart</a></li>
                                                        <li class="wishlist"><a href="wishlist.html"><i class="fa fa-heart-o"></i>Add to wishlist</a></li>
                                                        <li><a class="quick-view" data-toggle="modal" data-target="#exampleModalCenter" href="#"><i class="fa fa-eye"></i>Quick view</a></li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>

                                    }

                                </div>
                            </div>
                        </div>
                        <div class="pagination-area">
                            <div class="row">
                                <div class="col-lg-6 col-md-6 pt-xs-15">
                                    <p>Showing @((Model.PageNumber - 1) * Model.PageSize + 1)-@((Model.PageNumber - 1) * Model.PageSize + Model.Products.Count()) of @Model.TotalItems item(s)</p>
                                </div>
                                <div class="col-lg-6 col-md-6">
                                    <nav aria-label="Pagination">
                                        <ul class="pagination-box pt-xs-20 pb-xs-15">
                                            @if (Model.PageNumber > 1)
                                            {
                                                <li class="page-item">
                                                    <a href="@Url.Action("Index", new { PageNumber = Model.PageNumber - 1 })" class="Previous">
                                                        <i class="fa fa-chevron-left"></i> Previous
                                                    </a>
                                                </li>
                                            }

                                            @for (int i = 1; i <= Model.TotalPages; i++)
                                            {
                                                <li class="page-item @(i == Model.PageNumber ? "active" : "")">
                                                    <a href="@Url.Action("Index", new { PageNumber = i })">@i</a>
                                                </li>
                                            }

                                            @if (Model.PageNumber < Model.TotalPages)
                                            {
                                                <li class="page-item">
                                                    <a href="@Url.Action("Index", new { PageNumber = Model.PageNumber + 1 })" class="Next">
                                                        Next <i class="fa fa-chevron-right"></i>
                                                    </a>
                                                </li>
                                            }
                                        </ul>
                                    </nav>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
                <!-- shop-products-wrapper end -->
            </div>
            <form class="col-lg-3 order-2 order-lg-1" id="filterForm" method="post" action="@Url.Action("Index", "Product")">
                <!-- Replace with your controller name -->
                <div class="sidebar-categores-box mt-sm-30 mt-xs-30">
                    <div class="sidebar-title">
                        <h2>Danh mục</h2>
                    </div>
                    <div class="category-sub-menu">
                        <ul>
                            @foreach (var group in new Portal.Map.mapHome().getListMenuPGroupProduct())
                            {
                                <li class="has-sub">
                                    <a href="#">@group.Name</a>
                                    <ul>
                                        @foreach (var type in group.listTypeProduct)
                                        {
                                            <li><a href="#" onclick="filterByType('@type.id')">@type.name</a></li>
                                        }
                                    </ul>
                                </li>
                            }
                        </ul>
                    </div>
                </div>

                <div class="sidebar-categores-box">
                    <div class="sidebar-title">
                        <h2>Filter By</h2>
                    </div>
                    <button type="button" class="btn-clear-all mb-sm-30 mb-xs-30" onclick="clearFilters()">Clear all</button>
                    <div class="filter-sub-area">
                        @foreach (var category in new Portal.Map.mapProduct().getListMenuCategoryProduct())
                        {
                            <h5 class="filter-sub-title">@category.Name</h5>
                            <div class="categori-checkbox">
                                <ul>
                                    @foreach (var classification in category.listClassficationProduct)
                                    {
                                        <li>
                                            <input type="checkbox"
                                                   class="classification-checkbox"
                                                   value="@classification.id"
                                                   id="classification-@classification.id"
                                                   name="SelectedClassifications"
                                                   @(Model.SelectedClassifications != null && Model.SelectedClassifications.Contains(classification.id.ToString()) ? "checked" : "")
                                                   onclick="updateSelectedClassifications()">
                                            <label for="classification-@classification.id">@classification.name (13)</label>
                                        </li>
                                    }
                                </ul>
                            </div>
                        }
                    </div>
                </div>

                <!-- Hidden fields for additional data -->
                <input type="hidden" name="idGroup" value="@Model.idGroup" />
                <input type="hidden" name="idType" id="idType" value="@Model.idType" />
                <input type="hidden" name="idType" id="idType" value="@Model.ShortBy" />

            </form>


        </div>
    </div>

    @section scripts {
        <script type="text/javascript">
            function submitSortForm() {
                document.getElementById('sortForm').submit();
            }
            function setType(idType) {
                document.getElementById("idType").value = idType;
                document.getElementById("filterForm").submit(); // Submit the form
            }

            function filterByType(idType) {
                setType(idType);
            }

            function updateSelectedClassifications() {
                document.getElementById("filterForm").submit(); // Submit the form when a checkbox is clicked
            }

            function clearFilters() {
                // Clear the checkboxes and hidden fields
                document.querySelectorAll('.classification-checkbox').forEach(cb => cb.checked = false);
                document.getElementById("idType").value = "-1";
                document.getElementById("filterForm").submit(); // Submit the form to refresh the list
            }
           
        </script>
    }

